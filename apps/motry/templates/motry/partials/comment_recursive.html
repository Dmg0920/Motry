{% load motry_extras %}
{# éæ­¸æ¸²æŸ“ç•™è¨€(æœ€å¤šä¸‰å±¤) #}
<article class="comment comment--depth-{{ comment.get_depth }}" id="comment-{{ comment.id }}">
	<div class="comment__avatar" aria-hidden="true">
		{% if comment.user and comment.user.username %}
			{{ comment.user.username|first|upper }}
		{% else %}
			å®¢
		{% endif %}
	</div>
	<div class="comment__content">
		<header class="comment__header">
			<strong>{{ comment.user.username|default:"åŒ¿åè»Šå‹" }}</strong>
			<span>{{ comment.created_at|timesince }} å‰</span>
		</header>
		<p class="comment__text">{{ comment.body_text }}</p>
		{% if comment.image %}
			<img
				src="{{ comment.image.url }}"
				alt="ç•™è¨€åœ–ç‰‡"
				class="comment__image"
			/>
		{% elif comment.image_url and not comment.image_url|is_default_image %}
			<img
				src="{{ comment.image_url }}"
				alt="ç•™è¨€åœ–ç‰‡"
				class="comment__image"
			/>
		{% endif %}
		<div class="comment__toolbar">
			<span>{{ comment.created_at|timesince }} å‰</span>
			{% if user.is_authenticated and comment.can_reply %}
				<button type="button" class="comment__reply-toggle" data-reply-toggle data-target="reply-form-{{ comment.id }}">å›è¦†</button>
			{% endif %}
			{% if user.is_authenticated %}
				{% if comment.user_id == user.id %}
					<form action="{% url 'comment_delete' comment.id %}" method="post" class="comment__delete-form">
						{% csrf_token %}
						<input type="hidden" name="next" value="{{ request.get_full_path }}" />
						<button type="submit">åˆªé™¤</button>
					</form>
				{% endif %}
			{% endif %}
		</div>

		{# éæ­¸æ¸²æŸ“å­å›è¦† #}
		{% if comment.replies.all %}
			<div class="comment__replies" data-replies-container="{{ comment.id }}">
				{% for reply in comment.replies.all %}
					{% include "motry/partials/comment_recursive.html" with comment=reply %}
				{% endfor %}
			</div>
		{% else %}
			<div class="comment__replies" data-replies-container="{{ comment.id }}"></div>
		{% endif %}

		{# å›è¦†è¡¨å–®(åªåœ¨å¯å›è¦†æ™‚é¡¯ç¤º) #}
		{% if user.is_authenticated and comment.can_reply %}
			<form
				action="#"
				method="post"
				enctype="multipart/form-data"
				class="comment-form comment-form--inline"
				id="reply-form-{{ comment.id }}"
				data-comment-form
				data-parent-id="{{ comment.id }}"
				data-post-id="{{ post_id }}"
				hidden
			>
				{% csrf_token %}
				<input type="hidden" name="post" value="{{ post_id }}" />
				<input type="hidden" name="parent" value="{{ comment.id }}" />
				<div class="comment-form__fields">
					<textarea
						name="body_text"
						rows="1"
						placeholder="å›è¦† {{ comment.user.username|default:'è»Šå‹' }}â€¦"
						class="comment-form__input"
						required
					></textarea>
					<div class="comment-form__actions comment-form__actions--inline">
						<label class="comment-form__upload" title="ä¸Šå‚³åœ–ç‰‡">
							ğŸ“·
							<input type="file" name="image" accept="image/*" class="comment-form__file-input" />
						</label>
						<input type="url" name="image_url" placeholder="åœ–ç‰‡ç¶²å€ï¼ˆé¸å¡«ï¼‰" class="comment-form__url comment-form__url--inline" />
						<button type="submit" class="comment-form__submit">é€å‡º</button>
					</div>
				</div>
			</form>
		{% endif %}
	</div>
</article>
