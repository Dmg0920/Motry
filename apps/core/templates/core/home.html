{% extends "core/base.html" %}
{% load motry_extras %}

{% block title %}首頁 - Motry{% endblock %}
{% block content %}
<div class="page-container page-stack">
	<section class="card card--hero">
		<div class="layout layout--split layout--align-top">
			<div class="hero__content stack-sm">
				<span class="badge">Smart Finder</span>
				<h1 class="hero-title">快速找到適合你的下一台座駕</h1>
				<p class="hero-subtitle">整合品牌、年份、性能等條件，只需幾秒就能篩出理想車款，還能即時看到車主分享。</p>
				<div class="hero-actions">
					<a href="/search" class="button">立即開始搜尋</a>
					{% if user.is_authenticated %}
						<a href="{% url 'post_create' %}" class="button button-ghost">發表心得</a>
					{% else %}
						<a href="{% url 'register' %}" class="button button-ghost">加入社群</a>
					{% endif %}
				</div>
			</div>
			<div class="hero__aside">
				<h3>快速搜尋</h3>
				<p class="hero-subtitle hero-subtitle--compact">輸入關鍵字或設定條件，立即查看符合的車款。</p>
				<form action="/search" method="get" class="quick-search">
					<div class="quick-search__row">
						<input type="text" name="query" placeholder="輸入車名或品牌" />
					</div>
					<div class="quick-search__row">
						<select name="type" id="home-search-type" class="form-select form-select--compact">
							<option value="">全部類型</option>
							<option value="car">汽車</option>
							<option value="bike">機車</option>
						</select>
						<select
							name="brand"
							class="form-select form-select--compact"
							data-brand-select
							data-type-input="#home-search-type"
						>
							<option value="">熱門品牌</option>
						</select>
					</div>
					<div class="quick-search__row">
						<span>
							<label>排氣量 (cc)</label>
							<input type="number" name="displacement_min" placeholder="最小" min="0" />
						</span>
						<span>
							<label>&nbsp;</label>
							<input type="number" name="displacement_max" placeholder="最大" min="0" />
						</span>
					</div>
					<div class="quick-search__row">
						<span>
							<label>馬力 (PS)</label>
							<input type="number" name="hp_min" placeholder="最小" min="0" />
						</span>
						<span>
							<label>&nbsp;</label>
							<input type="number" name="hp_max" placeholder="最大" min="0" />
						</span>
						<span>
							<label>缸數</label>
							<input type="text" name="cylinders" placeholder="例：2,4" />
						</span>
					</div>
					<button type="submit" class="button">查看結果</button>
				</form>
			</div>
		</div>
	</section>

	<section class="card">
		<div class="section-heading">
			<div>
				<h2>熱門篩選捷徑</h2>
				<p class="hero-subtitle hero-subtitle--compact">依需求點擊，立即套用條件開始搜尋。</p>
			</div>
		</div>
		<div class="chip-list">
			<a href="/search?type=car" class="chip">熱門汽車</a>
			<a href="/search?type=bike" class="chip">熱門機車</a>
			<a href="/search?type=bike&displacement_max=200" class="chip">通勤輕檔車</a>
			<a href="/search?type=car&hp_min=250" class="chip">高性能選擇</a>
			<a href="/search?cylinders=2" class="chip">雙缸樂趣</a>
		</div>
	</section>

	<section class="card">
		<div class="section-heading">
			<div>
				<h2>社群趨勢</h2>
				<p class="hero-subtitle hero-subtitle--compact">看看大家最近在討論什麼車。</p>
			</div>
		</div>
		{% if popular_tags %}
			<div class="tag-cloud">
				{% for tag in popular_tags %}
					<a href="/search?query=%23{{ tag.name }}" class="tag-pill">#{{ tag.name }}</a>
				{% endfor %}
			</div>
		{% else %}
			<p class="empty-state">還沒有熱門標籤，快去分享心得吧！</p>
		{% endif %}
	</section>

	<section class="card">
		<div class="section-heading">
			<div>
				<h2>為你推薦</h2>
				<p class="hero-subtitle hero-subtitle--compact">隨機挑選幾台好評車款，快速了解重點規格。</p>
			</div>
		</div>
		{% if recommended_vehicles %}
			<div class="recommended-grid">
				{% for vehicle in recommended_vehicles %}
					<a href="/vehicle/{{ vehicle.id }}/" class="recommended-card">
						<div class="recommended-card__media">
							{% if vehicle.images.first and not vehicle.images.first.image_url|is_default_image %}
								<img
									src="{{ vehicle.images.first.image_url }}"
									alt="{{ vehicle.brand }} {{ vehicle.model }}"
									data-fallback="{% vehicle_fallback_image vehicle.brand vehicle.model %}"
								/>
							{% elif vehicle.cover_url and not vehicle.cover_url|is_default_image %}
								<img
									src="{{ vehicle.cover_url }}"
									alt="{{ vehicle.brand }} {{ vehicle.model }}"
									data-fallback="{% vehicle_fallback_image vehicle.brand vehicle.model %}"
								/>
							{% else %}
								<img
									src="{% vehicle_fallback_image vehicle.brand vehicle.model %}"
									alt="{{ vehicle.brand }} {{ vehicle.model }}"
								/>
							{% endif %}
						</div>
						<div class="recommended-card__body">
							<h4>{{ vehicle.brand }} {{ vehicle.model }}</h4>
							<p class="hero-subtitle hero-subtitle--compact">
								{% if vehicle.years_from %}{{ vehicle.years_from }}{% endif %}
								{% if vehicle.years_to %} - {{ vehicle.years_to }}{% endif %}
								{% if not vehicle.years_from and not vehicle.years_to %}年份待補{% endif %}
							</p>
							<ul class="pill-list pill-list--compact">
								{% if vehicle.displacement_cc %}
									<li class="pill pill--compact">{{ vehicle.displacement_cc }} cc</li>
								{% endif %}
								{% if vehicle.horsepower_ps %}
									<li class="pill pill--compact">{{ vehicle.horsepower_ps }} PS</li>
								{% endif %}
								{% if vehicle.type %}
									<li class="pill pill--compact">
										{% if vehicle.type == 'car' %}汽車{% elif vehicle.type == 'bike' %}機車{% else %}{{ vehicle.type }}{% endif %}
									</li>
								{% endif %}
							</ul>
						</div>
					</a>
				{% endfor %}
			</div>
		{% else %}
			<p class="empty-state empty-state--compact">稍後再回來看看，我們正在準備推薦內容。</p>
		{% endif %}
	</section>

	<section class="card">
		<div class="section-heading">
			<div>
				<h2>車友車庫</h2>
				<p class="hero-subtitle hero-subtitle--compact">看看其他車友分享的車庫與心得。</p>
			</div>
			<a href="{% url 'user_garage' %}" class="button button-ghost">管理我的車庫</a>
		</div>
		{% if latest_user_vehicles %}
			<div class="vehicle-grid">
				{% for garage in latest_user_vehicles %}
					<div class="vehicle-grid__card">
						<div class="vehicle-grid__media">
							{% if garage.image %}
								<img
									src="{{ garage.image.url }}"
									alt="{{ garage.alias|default:garage.vehicle }}"
									data-fallback="{% vehicle_fallback_image garage.vehicle.brand garage.vehicle.model %}"
								/>
							{% elif garage.image_url and not garage.image_url|is_default_image %}
								<img
									src="{{ garage.image_url }}"
									alt="{{ garage.alias|default:garage.vehicle }}"
									data-fallback="{% vehicle_fallback_image garage.vehicle.brand garage.vehicle.model %}"
								/>
							{% elif garage.vehicle.images.first and not garage.vehicle.images.first.image_url|is_default_image %}
								<img
									src="{{ garage.vehicle.images.first.image_url }}"
									alt="{{ garage.vehicle }}"
									data-fallback="{% vehicle_fallback_image garage.vehicle.brand garage.vehicle.model %}"
								/>
							{% elif garage.vehicle.cover_url and not garage.vehicle.cover_url|is_default_image %}
								<img
									src="{{ garage.vehicle.cover_url }}"
									alt="{{ garage.vehicle }}"
									data-fallback="{% vehicle_fallback_image garage.vehicle.brand garage.vehicle.model %}"
								/>
							{% else %}
								<img
									src="{% vehicle_fallback_image garage.vehicle.brand garage.vehicle.model %}"
									alt="{{ garage.vehicle }}"
								/>
							{% endif %}
						</div>
						<div class="vehicle-grid__body">
							{% if garage.alias %}
								<strong>{{ garage.alias }}</strong>
								<small>{{ garage.vehicle.brand }} {{ garage.vehicle.model }} ｜ 由 {{ garage.user.username }} 分享</small>
							{% else %}
								<strong>{{ garage.vehicle.brand }} {{ garage.vehicle.model }}</strong>
								<small>由 {{ garage.user.username }} 分享</small>
							{% endif %}
						</div>
						<div class="garage-card__actions">
							<a href="/vehicle/{{ garage.vehicle_id }}/" class="button button-ghost">查看車款</a>
							<a href="{% url 'post_create' %}?user_vehicle={{ garage.id }}" class="button">快速發文</a>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<p class="empty-state empty-state--compact">還沒有人分享車庫，快來成為第一個！</p>
		{% endif %}
	</section>
</div>
{% endblock %}
